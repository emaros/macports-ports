# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem        1.0
PortGroup         cmake 1.0

name              nds2-client
version           0.16.6
revision          0
categories        science
platforms         darwin
license           GPL-2
maintainers       {ligo.org:ed.maros @emaros} openmaintainer

description       Network Data Server Client
long_description \
  Client tool for accessing streamed LIGO data using the Network \
  Data Server version 2.

homepage          https://wiki.ligo.org/Computing/NDSClient
master_sites      https://software.igwn.org/lscsoft/source/
use_bzip2         yes

checksums         rmd160  d838d9602fc7e5258fae67b47fddaca99b58ea9e \
                  sha256  a6d83cc0f96f63ca7e045f3923dc178ad48a4869d61d5e2086d184c7965e5e15 \
                  size    583936

depends_build-append \
                  port:cmake \
                  port:doxygen \
                  path:bin/dot:graphviz \
                  port:pkgconfig \
                  port:boost

default_variants  +gssapi

cmake.out_of_source yes

compiler.cxx_standard 2011

configure.args    -DPYTHON=false \
                  -DPYTHON_EXECUTABLE=false \
                  -DWITH_SASL=no \
                  -DWITH_GSSAPI=no \
                  -DCMAKE_INSTALL_SYSCONFDIR=${prefix}/etc \
                  -DCMAKE_BUILD_TYPE=RelWithDebInfo \
                  -DCMAKE_EXPORT_COMPILE_COMMANDS=1

variant sasl description "Use cyrus-sasl2 for authentication" conflicts gssapi {

    configure.args-replace          -DWITH_SASL=no -DWITH_SASL=${prefix}
    depends_lib-append              port:cyrus-sasl2
}

variant gssapi description "Use kerberos5 gssapi for authentication" conflicts sasl {

    configure.args-replace          -DWITH_GSSAPI=no -DWITH_GSSAPI=${prefix}
    depends_lib-append              port:kerberos5

}

test.run           yes
test.cmd           ${prefix}/bin/ctest
test.target        -R '.*'

use_parallel_build yes

livecheck.type     regex
livecheck.url      ${master_sites}
livecheck.regex    {nds2-client-(\d+(?:\.\d+)*).tar.bz2}
