# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           active_variants 1.1
PortGroup           python 1.0

name                gds-dtt
version             2.19.5
revision            0

categories          science
platforms           darwin
license             GPL
maintainers         {@emaros ligo.org:ed.maros} openmaintainer

description         LSC Algorithm Library
long_description    LIGO Scientific Collaboration Algorithm Library containing core \
                    routines for gravitational wave data analysis.

homepage            https://git.ligo.org/gds/gds
master_sites        https://software.igwn.org/lscsoft/source/

checksums           rmd160  01c6808d4e184e4f93a4caf66a97e20da4c0f58b \
                    sha256  c5fd2570549aada5cdb1063d9b5dbcf999c7c0da3dabc200bc9433138b68f75c \
                    size    1802090

depends_build-append \
                    port:pkgconfig \
                    port:swig \
                    port:swig-python \
                    port:gds \
                    port:gds-gui \
                    port:gds-swig

depends_lib-append  port:expat \
                    port:fftw-3 \
                    port:fftw-3-single \
                    port:jsoncpp \
                    port:ldas-tools-framecpp \
                    port:metaio

#------------------------------------------------------------------------
# Fix things after PortGroup python
#------------------------------------------------------------------------
use_configure       yes
use_parallel_build  yes
build.cmd           make
build.target        all
destroot.cmd        ${build.cmd}
destroot.target     install
destroot.destdir    DESTDIR=${destroot}
destroot.args       " "
destroot.pre_args   ${destroot.target}
destroot.post_args  ${destroot.destdir}

configure.python    ${python.bin}
configure.args       --enable-dtt \
                    --enable-python \
                    --enable-root-objects \
                    --without-sasl \
                    --with-jsoncpp=${prefix}

#------------------------------------------------------------------------
# Use root 6 for High Sierra and beyond, else root 5
#------------------------------------------------------------------------
if {${os.platform} eq "darwin" && ${os.major} >= 17 } {
    use_autoreconf  yes
    use_automake    yes

    python.default_version  36
    destroot.args-append \
                    pythondir="${python.pkgd}" \
                    pyexecdir="${python.pkgd}" \
                    pkgpythondir="${python.pkgd}/${name}" \
                    pkgpyexecdir="${python.pkgd}/${name}"

    compiler.cxx_standard   2014

    depends_lib-append      port:root6 \
                            port:py${python.version}-numpy

    require_active_variants root6 python${python.version}
} else {
    python.default_version  27

    compiler.cxx_standard   2011

    depends_lib-append      port:root5 \
                            port:py${python.version}-numpy

    require_active_variants root5 python${python.version}
}

livecheck.type   regex
livecheck.url    ${master_sites}
livecheck.regex  {gds-dtt-(\d+(?:\.\d+)*).tar.gz}
